# 02. 현재 시스템 사용법

## 🚀 시스템 시작하기

### 1. 애플리케이션 실행
```bash
# 프로젝트 디렉토리에서
./gradlew bootRun

# 또는 Windows에서
gradlew.bat bootRun
```

### 2. 접속 정보
- **메인 페이지**: http://localhost:8080
- **날씨 대시보드**: http://localhost:8080/weather/dashboard
- **H2 콘솔**: http://localhost:8080/h2-console

### 3. H2 데이터베이스 접속 정보
```
JDBC URL: jdbc:h2:mem:testdb
사용자명: sa
비밀번호: (비워두세요)
```

## 📋 CSV 배치 시스템 사용법

### 1. 웹 UI를 통한 실행

#### 메인 페이지에서:
1. **http://localhost:8080** 접속
2. **"📤 CSV 배치 실행"** 버튼 클릭
3. 확인 대화상자에서 "확인" 클릭
4. 배치 실행 결과 확인

```javascript
// 실행 버튼 JavaScript 코드
function runBatch(button) {
    if(confirm('배치 작업을 실행하시겠습니까?')) {
        button.disabled = true;
        button.innerHTML = '⏳ 실행 중...';
        
        fetch('/run-batch', { method: 'POST' })
        .then(response => response.text())
        .then(data => {
            alert(data);  // 실행 결과 표시
            button.disabled = false;
            button.innerHTML = '📤 배치 실행';
        });
    }
}
```

### 2. REST API를 통한 실행

#### POST 요청으로 직접 실행:
```bash
curl -X POST http://localhost:8080/run-batch
```

#### 응답 예시:
```json
{
  "message": "배치가 성공적으로 완료되었습니다!",
  "jobExecutionId": 1,
  "status": "COMPLETED"
}
```

### 3. 처리되는 데이터 확인

#### CSV 파일 내용 (sample-data.csv):
```csv
firstName,lastName,email
김,철수,kim.chulsoo@example.com
이,영희,lee.younghee@example.com
박,민수,park.minsoo@example.com
최,수지,choi.suji@example.com
정,재호,jung.jaeho@example.com
```

#### 저장된 데이터 확인:
1. **웹 UI**: "📊 저장된 사용자 데이터" 버튼 클릭
2. **REST API**: GET http://localhost:8080/persons
3. **H2 콘솔**: `SELECT * FROM PERSON;`

## 🌦️ 날씨 배치 시스템 사용법

### 1. 날씨 대시보드 접속

#### 대시보드 메인 화면:
1. **http://localhost:8080/weather/dashboard** 접속
2. 실시간 날씨 데이터 현황 확인
3. 통계 카드에서 전체 수집 데이터 수, 모니터링 도시 수, 이상 기후 감지 수 확인

### 2. 날씨 데이터 수집 실행

#### 웹 UI를 통한 실행:
```html
<!-- 대시보드에서 -->
<button onclick="collectWeatherData()" class="btn btn-primary">
    🌍 날씨 데이터 수집
</button>
```

1. **"🌍 날씨 데이터 수집"** 버튼 클릭
2. 배치 실행 확인 (약 10-15초 소요)
3. 자동 페이지 새로고침 (3초 후)
4. 업데이트된 날씨 데이터 확인

#### REST API를 통한 실행:
```bash
curl -X POST http://localhost:8080/weather/collect
```

### 3. 수집 대상 도시

#### 전국 주요 8개 도시:
```java
List<String> cities = List.of(
    "Seoul",    // 서울
    "Busan",    // 부산
    "Incheon",  // 인천
    "Daegu",    // 대구
    "Daejeon",  // 대전
    "Gwangju",  // 광주
    "Ulsan",    // 울산
    "Suwon"     // 수원
);
```

### 4. 수집되는 날씨 정보

#### 기본 날씨 데이터:
- **온도 정보**: 현재 온도, 체감 온도, 최고/최저 온도
- **기상 상태**: 날씨 상태 (맑음, 흐림, 비 등), 상세 설명
- **대기 정보**: 습도, 기압, 가시거리
- **바람 정보**: 풍속, 풍향
- **강수 정보**: 강수량, 적설량 (1시간 단위)

#### 추가 분석 데이터:
- **수집 시간**: 데이터 수집 시각
- **온도 변화량**: 전날 동시간 대비 온도 차이
- **이상 기후 여부**: 20도 이상 온도 변화 시 true

### 5. 실시간 데이터 모니터링

#### 대시보드 섹션별 기능:

##### 📊 통계 카드:
```html
<div class="stats-grid">
    <div class="stat-card">
        <h3>전체 수집 데이터</h3>
        <div class="value">1,234</div>
    </div>
    <div class="stat-card">
        <h3>모니터링 도시</h3>
        <div class="value">8</div>
    </div>
    <div class="stat-card">
        <h3>이상 기후 감지</h3>
        <div class="value">2</div>
    </div>
</div>
```

##### 🌤️ 도시별 현재 날씨:
- 각 도시의 최신 날씨 정보
- 온도, 날씨 상태, 수집 시간
- 전날 대비 온도 변화량 표시

##### 🌡️ 온도 순위:
- 현재 온도 기준 도시별 순위
- 습도, 체감 온도 추가 정보

##### ⚠️ 이상 기후 알림:
- 전날 대비 20도 이상 변화한 지역
- 급격한 온도 변화 감지 시 자동 표시

## 🔧 API 엔드포인트 가이드

### CSV 배치 관련 API

#### 1. 배치 실행
```http
POST /run-batch
Content-Type: application/json

Response:
{
  "message": "배치가 성공적으로 완료되었습니다!",
  "jobExecutionId": 1,
  "status": "COMPLETED"
}
```

#### 2. 저장된 사용자 데이터 조회
```http
GET /persons

Response:
[
  {
    "id": 1,
    "firstName": "김",
    "lastName": "철수",
    "email": "kim.chulsoo@example.com"
  },
  ...
]
```

### 날씨 배치 관련 API

#### 1. 날씨 데이터 수집 실행
```http
POST /weather/collect

Response: "날씨 데이터 수집 배치가 시작되었습니다. 상태: STARTED"
```

#### 2. 전체 날씨 데이터 조회
```http
GET /weather/data

Response:
[
  {
    "id": 1,
    "cityCode": "Seoul",
    "cityName": "서울",
    "temperature": 15.5,
    "humidity": 65,
    "weatherMain": "Clear",
    "collectedAt": "2025-08-27T14:30:00",
    "isAbnormal": false,
    "temperatureChange": 2.1
  },
  ...
]
```

#### 3. 도시별 최신 날씨 조회
```http
GET /weather/current

Response: [최신 날씨 데이터만]
```

#### 4. 이상 기후 데이터 조회
```http
GET /weather/abnormal

Response: [이상 기후로 감지된 데이터만]
```

#### 5. 날씨 통계 조회
```http
GET /weather/statistics

Response:
{
  "todayRecords": 24,
  "averageTemperature": 18.5,
  "maxTemperature": 25.2,
  "minTemperature": 12.1,
  "abnormalCount": 1
}
```

## 🛠️ 데이터베이스 직접 조회

### H2 콘솔 사용법

#### 1. 콘솔 접속:
1. http://localhost:8080/h2-console 접속
2. JDBC URL: `jdbc:h2:mem:testdb` 입력
3. 사용자명: `sa`, 비밀번호: 빈값
4. "Connect" 클릭

#### 2. 유용한 SQL 쿼리:

##### 전체 사용자 데이터 조회:
```sql
SELECT * FROM PERSON;
```

##### 날씨 데이터 조회:
```sql
-- 최신 날씨 데이터
SELECT city_name, temperature, weather_main, collected_at 
FROM WEATHER_DATA 
ORDER BY collected_at DESC 
LIMIT 10;

-- 이상 기후 데이터
SELECT city_name, temperature, temperature_change, collected_at
FROM WEATHER_DATA 
WHERE is_abnormal = true
ORDER BY collected_at DESC;

-- 도시별 평균 온도
SELECT city_name, AVG(temperature) as avg_temp, COUNT(*) as records
FROM WEATHER_DATA 
GROUP BY city_name;
```

## ⚠️ 주의사항 및 문제 해결

### 1. API 키 설정 확인
```bash
# .env 파일 확인
cat .env

# 출력 예시:
# WEATHER_API_KEY=4336a7df2186cc57454035002475e06a
```

### 2. 포트 충돌 해결
```bash
# 8080 포트 사용 중인 프로세스 확인
netstat -ano | findstr :8080

# 프로세스 종료 (Windows)
taskkill /F /PID [프로세스ID]
```

### 3. 배치 실행 실패 시
- 로그 확인: 콘솔 출력에서 ERROR 레벨 메시지 확인
- API 키 유효성 확인
- 인터넷 연결 상태 확인
- H2 데이터베이스 연결 상태 확인

### 4. 일반적인 에러 해결

#### "API 키가 설정되지 않았습니다" 에러:
```bash
# .env 파일 생성 또는 수정
echo "WEATHER_API_KEY=4336a7df2186cc57454035002475e06a" > .env
```

#### "포트 8080이 이미 사용 중" 에러:
1. 다른 프로세스 종료
2. 또는 application.properties에서 포트 변경:
```properties
server.port=8081
```

이제 시스템을 완전히 활용할 수 있습니다. 다음 문서에서는 이 시스템을 어떻게 공부하고 확장할 수 있는지 알아보겠습니다.