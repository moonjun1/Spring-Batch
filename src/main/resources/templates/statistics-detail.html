<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>날씨 통계 상세 - Spring Batch</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col">
                <h1 class="text-center text-primary">
                    <i class="fas fa-chart-line me-2"></i>날씨 통계 상세
                </h1>
                <p class="text-center text-muted">최근 30일간의 날씨 통계 데이터를 상세히 확인하세요</p>
            </div>
        </div>

        <!-- 전국 평균 온도 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card bg-info text-white">
                    <div class="card-body text-center">
                        <h4 class="mb-0">
                            <i class="fas fa-thermometer-half me-2"></i>전국 평균 온도 (최근 7일)
                        </h4>
                        <h2 class="mt-2" th:text="${nationalAvgTemp != null ? #numbers.formatDecimal(nationalAvgTemp, 0, 1) + '°C' : '데이터 없음'}">-</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- 이상 기후 발생 순위 -->
        <div class="row mb-4" th:if="${not #lists.isEmpty(abnormalWeatherStats)}">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="fas fa-exclamation-triangle me-2"></i>이상 기후 발생 순위 (최근 30일)
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>순위</th>
                                        <th>도시</th>
                                        <th>날짜</th>
                                        <th>이상기후 발생</th>
                                        <th>최대 온도 변화</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="stat, iterStat : ${abnormalWeatherStats}">
                                        <td>
                                            <span class="badge bg-warning text-dark" th:text="${iterStat.count}">1</span>
                                        </td>
                                        <td th:text="${stat.cityName}">서울</td>
                                        <td th:text="${stat.statisticsDate}">2024-01-01</td>
                                        <td>
                                            <span class="badge bg-danger" th:text="${stat.abnormalWeatherCount} + '건'">0건</span>
                                        </td>
                                        <td>
                                            <span th:if="${stat.maxTemperatureChange != null}" 
                                                  th:text="${#numbers.formatDecimal(stat.maxTemperatureChange, 0, 1)} + '°C'">-</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 전체 통계 데이터 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-table me-2"></i>전체 통계 데이터 (최근 30일)
                        </h5>
                    </div>
                    <div class="card-body">
                        <div th:if="${#lists.isEmpty(allStatistics)}" class="text-center text-muted py-4">
                            <i class="fas fa-info-circle fa-3x mb-3"></i>
                            <p>생성된 통계 데이터가 없습니다.</p>
                        </div>
                        <div th:if="${not #lists.isEmpty(allStatistics)}" class="table-responsive">
                            <table class="table table-hover table-sm">
                                <thead class="table-light">
                                    <tr>
                                        <th>날짜</th>
                                        <th>도시</th>
                                        <th>평균온도</th>
                                        <th>최고온도</th>
                                        <th>최저온도</th>
                                        <th>온도범위</th>
                                        <th>습도</th>
                                        <th>기압</th>
                                        <th>주요날씨</th>
                                        <th>맑음</th>
                                        <th>흐림</th>
                                        <th>비</th>
                                        <th>이상기후</th>
                                        <th>데이터수</th>
                                        <th>수집률</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="stat : ${allStatistics}">
                                        <td th:text="${stat.statisticsDate}">2024-01-01</td>
                                        <td>
                                            <small class="badge bg-secondary" th:text="${stat.cityName}">서울</small>
                                        </td>
                                        <td th:text="${stat.avgTemperature != null ? #numbers.formatDecimal(stat.avgTemperature, 0, 1) + '°' : '-'}">-</td>
                                        <td th:text="${stat.maxTemperature != null ? #numbers.formatDecimal(stat.maxTemperature, 0, 1) + '°' : '-'}">-</td>
                                        <td th:text="${stat.minTemperature != null ? #numbers.formatDecimal(stat.minTemperature, 0, 1) + '°' : '-'}">-</td>
                                        <td th:text="${stat.temperatureRange != null ? #numbers.formatDecimal(stat.temperatureRange, 0, 1) + '°' : '-'}">-</td>
                                        <td th:text="${stat.avgHumidity != null ? stat.avgHumidity + '%' : '-'}">-</td>
                                        <td th:text="${stat.avgPressure != null ? stat.avgPressure + 'hPa' : '-'}">-</td>
                                        <td>
                                            <small class="badge bg-info" th:text="${stat.dominantWeather ?: '-'}">-</small>
                                        </td>
                                        <td th:text="${stat.clearHours ?: 0} + 'h'">0h</td>
                                        <td th:text="${stat.cloudyHours ?: 0} + 'h'">0h</td>
                                        <td th:text="${stat.rainyHours ?: 0} + 'h'">0h</td>
                                        <td>
                                            <span th:if="${stat.abnormalWeatherCount != null and stat.abnormalWeatherCount > 0}" 
                                                  class="badge bg-danger" 
                                                  th:text="${stat.abnormalWeatherCount} + '건'">-</span>
                                            <span th:unless="${stat.abnormalWeatherCount != null and stat.abnormalWeatherCount > 0}" 
                                                  class="text-success">정상</span>
                                        </td>
                                        <td th:text="${stat.totalRecords ?: 0}">0</td>
                                        <td>
                                            <span th:if="${stat.dataCollectionRate != null}" 
                                                  th:text="${#numbers.formatDecimal(stat.dataCollectionRate, 0, 1)} + '%'">-</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 네비게이션 -->
        <div class="text-center">
            <a href="/batch-results" class="btn btn-success me-2">
                <i class="fas fa-arrow-left me-1"></i>배치 결과로 돌아가기
            </a>
            <a href="/batch-test" class="btn btn-primary me-2">
                <i class="fas fa-cogs me-1"></i>배치 테스트
            </a>
            <a href="/" class="btn btn-outline-primary">
                <i class="fas fa-home me-1"></i>메인 페이지
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>