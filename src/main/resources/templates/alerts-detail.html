<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>날씨 알림 상세 - Spring Batch</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col">
                <h1 class="text-center text-warning">
                    <i class="fas fa-bell me-2"></i>날씨 알림 상세
                </h1>
                <p class="text-center text-muted">최근 30일간의 날씨 알림 데이터를 상세히 확인하세요</p>
            </div>
        </div>

        <!-- 알림 유형별 통계 -->
        <div class="row mb-4" th:if="${not #lists.isEmpty(alertTypeStats)}">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-pie me-2"></i>알림 유형별 통계 (최근 30일)
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>알림 유형</th>
                                        <th>알림 수준</th>
                                        <th>발생 횟수</th>
                                        <th>비율</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="stat : ${alertTypeStats}">
                                        <td>
                                            <span th:text="${stat[0]}" class="badge bg-primary">알림유형</span>
                                        </td>
                                        <td>
                                            <span th:text="${stat[1]}" class="badge bg-warning text-dark">수준</span>
                                        </td>
                                        <td>
                                            <strong th:text="${stat[2]}">0</strong>건
                                        </td>
                                        <td>
                                            <div class="progress" style="width: 100px; height: 20px;">
                                                <div class="progress-bar" role="progressbar" 
                                                     th:style="'width: ' + (${stat[2]} * 100 / ${#lists.size(allAlerts)}) + '%'"
                                                     th:text="${#numbers.formatDecimal(${stat[2]} * 100 / ${#lists.size(allAlerts)}, 0, 1)} + '%'">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 도시별 알림 빈도 -->
        <div class="row mb-4" th:if="${not #lists.isEmpty(cityAlertFrequency)}">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-map-marker-alt me-2"></i>도시별 알림 발생 빈도 (최근 30일)
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>순위</th>
                                        <th>도시</th>
                                        <th>알림 유형</th>
                                        <th>발생 횟수</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="freq, iterStat : ${cityAlertFrequency}">
                                        <td>
                                            <span class="badge bg-danger" th:text="${iterStat.count}">1</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-secondary" th:text="${freq[0]}">도시</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-info" th:text="${freq[1]}">유형</span>
                                        </td>
                                        <td>
                                            <strong th:text="${freq[2]}">0</strong>건
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 전체 알림 데이터 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="fas fa-list me-2"></i>전체 알림 데이터 (최근 30일)
                        </h5>
                    </div>
                    <div class="card-body">
                        <div th:if="${#lists.isEmpty(allAlerts)}" class="text-center text-muted py-4">
                            <i class="fas fa-check-circle fa-3x mb-3"></i>
                            <p>생성된 알림이 없습니다.<br>모든 상황이 정상입니다!</p>
                        </div>
                        <div th:if="${not #lists.isEmpty(allAlerts)}" class="table-responsive">
                            <table class="table table-hover table-sm">
                                <thead class="table-light">
                                    <tr>
                                        <th>발생일시</th>
                                        <th>도시</th>
                                        <th>유형</th>
                                        <th>수준</th>
                                        <th>제목</th>
                                        <th>메시지</th>
                                        <th>감지값</th>
                                        <th>임계값</th>
                                        <th>발송상태</th>
                                        <th>해결상태</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="alert : ${allAlerts}">
                                        <td>
                                            <small th:text="${#temporals.format(alert.alertTime, 'MM-dd HH:mm')}">01-01 12:00</small>
                                        </td>
                                        <td>
                                            <small class="badge bg-secondary" th:text="${alert.cityName}">서울</small>
                                        </td>
                                        <td>
                                            <small th:switch="${alert.alertType?.name()}" class="badge">
                                                <span th:case="'HEAT_WAVE'" class="badge bg-danger">폭염</span>
                                                <span th:case="'COLD_WAVE'" class="badge bg-info">한파</span>
                                                <span th:case="'HEAVY_RAIN'" class="badge bg-primary">호우</span>
                                                <span th:case="'ABNORMAL_WEATHER'" class="badge bg-warning text-dark">이상기후</span>
                                                <span th:case="*" class="badge bg-secondary" th:text="${alert.alertType?.koreanName}">기타</span>
                                            </small>
                                        </td>
                                        <td>
                                            <small th:switch="${alert.alertLevel?.name()}" class="badge">
                                                <span th:case="'EMERGENCY'" class="badge bg-danger">긴급</span>
                                                <span th:case="'WARNING'" class="badge bg-warning text-dark">경보</span>
                                                <span th:case="'ADVISORY'" class="badge bg-info">주의보</span>
                                                <span th:case="'NOTICE'" class="badge bg-secondary">주의</span>
                                                <span th:case="*" class="badge bg-light text-dark" th:text="${alert.alertLevel?.koreanName}">-</span>
                                            </small>
                                        </td>
                                        <td>
                                            <small th:text="${alert.alertTitle}">알림 제목</small>
                                        </td>
                                        <td>
                                            <small th:text="${#strings.abbreviate(alert.alertMessage, 30)}">알림 메시지</small>
                                        </td>
                                        <td>
                                            <small th:if="${alert.triggerValue != null}" 
                                                   class="fw-bold" 
                                                   th:text="${#numbers.formatDecimal(alert.triggerValue, 0, 1)}">-</small>
                                        </td>
                                        <td>
                                            <small th:if="${alert.thresholdValue != null}" 
                                                   th:text="${#numbers.formatDecimal(alert.thresholdValue, 0, 1)}">-</small>
                                        </td>
                                        <td>
                                            <small th:if="${alert.isSent}" class="badge bg-success">완료</small>
                                            <small th:unless="${alert.isSent}" class="badge bg-secondary">대기</small>
                                        </td>
                                        <td>
                                            <small th:if="${alert.isResolved}" class="badge bg-success">해결</small>
                                            <small th:unless="${alert.isResolved}" class="badge bg-warning text-dark">진행중</small>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 네비게이션 -->
        <div class="text-center">
            <a href="/batch-results" class="btn btn-success me-2">
                <i class="fas fa-arrow-left me-1"></i>배치 결과로 돌아가기
            </a>
            <a href="/batch-test" class="btn btn-primary me-2">
                <i class="fas fa-cogs me-1"></i>배치 테스트
            </a>
            <a href="/" class="btn btn-outline-primary">
                <i class="fas fa-home me-1"></i>메인 페이지
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>